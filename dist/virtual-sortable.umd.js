(function(H,m){typeof exports=="object"&&typeof module<"u"?m(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],m):(H=typeof globalThis<"u"?globalThis:H||self,m(H.VirtualSortable={},H.Vue))})(this,(function(H,m){"use strict";const zt={capture:!1,passive:!1},Dt=/\s+/g;function Z(o){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(o)}const st=Z(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),_t=Z(/Edge/i),gt=Z(/safari/i)&&!Z(/chrome/i)&&!Z(/android/i),Ot=(function(){let o=!1;return document.addEventListener("checkIfSupportPassive",null,{get passive(){return o=!0,!0}}),o})();function _(o,t,e){window.addEventListener?o.addEventListener(t,e,Ot||!st?zt:!1):window.attachEvent?o.attachEvent("on"+t,e):o["on"+t]=e}function z(o,t,e){window.removeEventListener?o.removeEventListener(t,e,Ot||!st?zt:!1):window.detachEvent?o.detachEvent("on"+t,e):o["on"+t]=null}function Xt(o,t){if(!o||!o.getBoundingClientRect)return rt();let e=o;do if(e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight){let n=S(e);if(e.clientWidth<e.scrollWidth&&(n.overflowX=="auto"||n.overflowX=="scroll")||e.clientHeight<e.scrollHeight&&(n.overflowY=="auto"||n.overflowY=="scroll"))return!e.getBoundingClientRect||e===document.body?rt():e}while(e=e.parentNode);return rt()}function rt(){return document.scrollingElement||document.documentElement}function D(o,t,e){if(!o.getBoundingClientRect&&o!==window)return;let n,i,s,r,a,d,f;if(o!==window&&o.parentNode&&o!==rt()?(n=o.getBoundingClientRect(),i=n.top,s=n.left,r=n.bottom,a=n.right,d=n.height,f=n.width):(i=0,s=0,r=window.innerHeight,a=window.innerWidth,d=window.innerHeight,f=window.innerWidth),t&&o!==window){e=e||o.parentNode;do if(e&&e.getBoundingClientRect){let y=e.getBoundingClientRect();i-=y.top+parseInt(S(e,"border-top-width")),s-=y.left+parseInt(S(e,"border-left-width")),r=i+n.height,a=s+n.width;break}while(e=e.parentNode)}return{top:i,left:s,bottom:r,right:a,width:f,height:d}}function tt(o,t,e,n){if(o){e=e||document;do{if(t!=null&&(t[0]===">"?o.parentNode===e&&lt(o,t):lt(o,t))||n&&o===e)return o;if(o===e)break}while(o=o.parentNode);return null}}function mt(o,t){if(!o||!t)return!1;if(t.compareDocumentPosition)return!!(t.compareDocumentPosition(o)&16);if(t.contains&&o.nodeType===1)return t.contains(o)&&t!==o;for(;o=o.parentNode;)if(o===t)return!0;return!1}function Mt(o,t){let e=o.lastElementChild;for(;e&&(e===g.ghost||S(e,"display")==="none"||t);)e=e.previousElementSibling;return e||null}function W(o,t){if(!o||!o.parentNode)return-1;let e=0;for(;o=o.previousElementSibling;)o!==g.ghost&&o.nodeName.toUpperCase()!=="TEMPLATE"&&S(o,"display")!=="none"&&(!t||lt(o,t))&&e++;return e}function St(o,t,e,n){let i=0,s=0,r=o.children;for(;i<r.length;){if(r[i]!==g.ghost&&S(r[i],"display")!=="none"&&tt(r[i],e,o,!1)&&r[i]!==g.dragged){if(s===t)return r[i];s++}i++}return null}function Rt(o,t){let e=S(o),n=parseInt(e.width)-parseInt(e.paddingLeft)-parseInt(e.paddingRight)-parseInt(e.borderLeftWidth)-parseInt(e.borderRightWidth),i=St(o,0,t),s=St(o,1,t),r=i&&S(i),a=s&&S(s),d=r&&parseInt(r.marginLeft)+parseInt(r.marginRight)+D(i).width,f=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+D(s).width,y=_t||st?"cssFloat":"float";if(e.display==="flex")return e.flexDirection==="column"||e.flexDirection==="column-reverse"?"vertical":"horizontal";if(e.display==="grid")return e.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(i&&r.float&&r.float!=="none"){let v=r.float==="left"?"left":"right";return s&&(a.clear==="both"||a.clear===v)?"vertical":"horizontal"}return i&&(r.display==="block"||r.display==="flex"||r.display==="table"||r.display==="grid"||d>=n&&e[y]==="none"||s&&e[y]==="none"&&d+f>n)?"vertical":"horizontal"}function F(o,t,e){if(o&&t)if(o.classList)o.classList[e?"add":"remove"](t);else{const n=(" "+o.className+" ").replace(Dt," ").replace(" "+t+" "," ");o.className=(n+(e?" "+t:"")).replace(Dt," ")}}function lt(o,t){if(t){if(t[0]===">"&&(t=t.substring(1)),o)try{if(o.matches)return o.matches(t);if(o.msMatchesSelector)return o.msMatchesSelector(t);if(o.webkitMatchesSelector)return o.webkitMatchesSelector(t)}catch{return!1}return!1}}function S(o,t,e){let n=o&&o.style;if(n){if(e===void 0)return document.defaultView&&document.defaultView.getComputedStyle?e=document.defaultView.getComputedStyle(o,""):o.currentStyle&&(e=o.currentStyle),t===void 0?e:e[t];!(t in n)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),n[t]=e+(typeof e=="string"?"":"px")}}function $t(o,t){let e="";if(typeof o=="string")e=o;else do{let i=S(o,"transform");i&&i!=="none"&&(e=i+" "+e)}while(!1);const n=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return n&&new n(e)}function Bt(o,t){return Math.round(o.top)===Math.round(t.top)&&Math.round(o.left)===Math.round(t.left)&&Math.round(o.height)===Math.round(t.height)&&Math.round(o.width)===Math.round(t.width)}function Vt(o){return o.offsetWidth}function jt(o,t){return o.compareDocumentPosition?o.compareDocumentPosition(t):o.contains?(o!=t&&o.contains(t)&&16)+(o!=t&&t.contains(o)&&8)+(o.sourceIndex>=0&&t.sourceIndex>=0?(o.sourceIndex<t.sourceIndex&&4)+(o.sourceIndex>t.sourceIndex&&2):1):0}function yt(o,t){const e=jt(o,t);return e===2?1:e===4?-1:0}function at(o){o.preventDefault!==void 0&&o.cancelable&&o.preventDefault()}function O({sortable:o,name:t,evt:e}){const n=o.options[t];if(typeof n=="function")return n(Object.assign({},e))}function ct(o,...t){return typeof o=="function"?o(...t):o}const R="Sortable"+Date.now();function Nt(o){this.options=o,this.scrollEl=null,this.autoScrollInterval=null}Nt.prototype={nulling(){this.autoScrollInterval&&(clearInterval(this.autoScrollInterval),this.autoScrollInterval=null)},onStarted(){this.nulling(),this.autoScrollInterval=setInterval(this.autoScroll.bind(this))},onMove(o,t,e,n){const i=e?e[R].options:n;if(e&&!i.autoScroll){this.scrollEl=null;return}this.options=i,this.scrollEl=Xt(o),this.moveEvent=t},autoScroll(){let o=this.options,t=this.moveEvent,e=this.scrollEl,n=o.scrollThreshold,i=o.scrollSpeed;if(!e||t.clientX===void 0||t.clientY===void 0)return;const s=D(e);if(!s)return;const{clientX:r,clientY:a}=t,{top:d,right:f,bottom:y,left:v,height:C,width:ot}=s;if(a<d||r>f||a>y||r<v)return;const{scrollTop:Y,scrollLeft:ut,scrollHeight:wt,scrollWidth:xt}=e;e.scrollLeft+=this.getScrollOffset(r,v,f,n,i.x,ut,xt,ot),e.scrollTop+=this.getScrollOffset(a,d,y,n,i.y,Y,wt,C)},getScrollOffset(o,t,e,n,i,s,r,a){return s>0&&o>=t&&o<=t+n?Math.max(-1,(o-t)/n-1)*i:s+a<r&&o<=e&&o>=e-n?Math.min(1,(o-e)/n+1)*i:0}};function kt(o){this.options=o,this.animationStack=[],this.animationCallbackId=null}kt.prototype={collect(o){if(!o)return;let t=D(o),e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,i=Math.min(t.right,e),s=Math.min(t.bottom,n),r=Array.prototype.slice.call(o.children),a=[];for(let d=0,f=r.length;d<f;d++){const y=r[d];if(y===g.ghost||S(y,"display")==="none")continue;const v=D(y);if(!(v.bottom<0||v.right<0)){if(a.length===0&&y.previousElementSibling){let C=y.previousElementSibling;do if(C&&C!==g.ghost&&S(C,"display")!=="none")break;while(C=C.previousElementSibling);C&&a.push({el:C,rect:D(C)})}if(v.top-v.height>s||v.left-v.width>i){a.push({el:y,rect:v});break}a.push({el:y,rect:v})}}this.animationStack.push(a)},animate(o){let t=this.animationStack.pop(),e=this.options.animation;if(!t||!e){clearTimeout(this.animationCallbackId),typeof o=="function"&&o();return}let n=0;t.forEach(i=>{let s=0,r=i.el,a=D(r),d=i.rect,f=r.prevToRect,y=r.prevFromRect;if(r.animating&&y&&f&&Bt(d,a)){const v=$t(r);if(v){const C={top:a.top-v.f,left:a.left-v.e},ot=At(C,a),Y=At(y,f);s=ot/Y*e}}Bt(d,a)||(r.prevFromRect=d,r.prevToRect=a,s||(s=e),this.execute(r,d,a,s)),s&&(n=Math.max(n,s))}),clearTimeout(this.animationCallbackId),n?this.animationCallbackId=setTimeout(()=>{typeof o=="function"&&o()},n):typeof o=="function"&&o()},execute(o,t,e,n){let i=this.options.easing||"",s=t.left-e.left,r=t.top-e.top;S(o,"transition",""),S(o,"transform",`translate3d(${s}px, ${r}px, 0)`),this.repaintDummy=Vt(o),S(o,"transition",`transform ${n}ms ${i}`),S(o,"transform","translate3d(0px, 0px, 0px)"),typeof o.animating=="number"&&clearTimeout(o.animating),o.animating=setTimeout(()=>{S(o,"transition",""),S(o,"transform",""),o.prevFromRect=null,o.prevToRect=null,o.animating=null},n)}};function At(o,t){return Math.sqrt(Math.pow(o.left-t.left,2)+Math.pow(o.top-t.top,2))}let ht=[],P,T,h,p,q,E,c,I,k,x,X,L,et,$,M,A,V,B,K,U,j;function Kt(o){let t={},e=o.group;(!e||typeof e!="object")&&(e={name:e,pull:!0,put:!0,revertDrag:!0}),t.name=e.name,t.pull=e.pull??!0,t.put=e.put??!0,t.revertDrag=e.revertDrag??!0,o.group=t}function Gt(o,t){let e;return ht.reduce((n,i)=>{const s=i[R].options.emptyInsertThreshold;if(s==null)return;const r=D(i),a=o>=r.left-s&&o<=r.right+s,d=t>=r.top-s&&t<=r.bottom+s;return a&&d&&(!e||e&&r.left>=e.left&&r.right<=e.right&&r.top>=e.top&&r.bottom<=e.bottom)&&(n=i,e=r),n},null)}function Jt(o){const t=A||M;return!(o.clientX!==void 0&&o.clientY!==void 0&&Math.abs(o.clientX-t.clientX)<=0&&Math.abs(o.clientY-t.clientY)<=0)}function g(o,t){if(!(o&&o.nodeType&&o.nodeType===1))throw`Sortable-dnd: \`el\` must be an HTMLElement, not ${{}.toString.call(o)}`;o[R]=this,this.el=o,this.options=t=Object.assign({},t);const e={store:null,group:"",handle:null,draggable:">*",sortable:!0,disabled:!1,customGhost:null,lockAxis:"",direction:"",animation:150,easing:"",ghostClass:"",ghostStyle:{},chosenClass:"",placeholderClass:"",autoScroll:!0,scrollThreshold:55,scrollSpeed:{x:10,y:10},delay:0,delayOnTouchOnly:!1,swapOnDrop:!0,removeCloneOnDrop:!0,dropOnAnimationEnd:!1,appendToBody:!1,supportTouch:"ontouchstart"in window,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,emptyInsertThreshold:-1};for(let n in e)!(n in t)&&(t[n]=e[n]);Kt(t);for(let n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this));_(o,t.supportTouch?"touchstart":"mousedown",this._onDrag),this.autoScroller=new Nt(t),this.animator=new kt(t),ht.push(o)}g.prototype={constructor:g,_onDrag(o){let t=this.el,e=this.options,n=e.handle,i=o.touches&&o.touches[0],s=(i||o).target,r=t.ownerDocument;if(h||e.disabled||!e.group.pull||/mousedown|pointerdown/.test(o.type)&&o.button!==0||gt&&s&&s.tagName.toUpperCase()==="SELECT")return;const a=tt(s,e.draggable,t);!a||a.animating||(M={event:o,clientX:(i||o).clientX,clientY:(i||o).clientY},h=a,B=i?h:document,_(B,"mouseup",this._onDrop),_(B,"touchend",this._onDrop),_(B,"touchcancel",this._onDrop),!(typeof n=="function"&&!n(o)||typeof n=="string"&&!tt(s,n,h))&&(e.delay&&(!e.delayOnTouchOnly||i)&&!(_t||st)?(_(r,"touchmove",this._delayedMoveHandler),_(r,"mousemove",this._delayedMoveHandler),_(r,"mouseup",this._cancelStart),_(r,"touchend",this._cancelStart),_(r,"touchcancel",this._cancelStart),this._dragStartTimer=setTimeout(()=>this._onStart(i,o),e.delay)):this._onStart(i,o)))},_delayedMoveHandler(o){const t=o.touches?o.touches[0]:o;Math.max(Math.abs(t.clientX-M.clientX),Math.abs(t.clientY-M.clientY))>=Math.floor(this.options.touchStartThreshold/(window.devicePixelRatio||1))&&this._cancelStart()},_cancelStart(){let o=this.el.ownerDocument;clearTimeout(this._dragStartTimer),z(o,"touchmove",this._delayedMoveHandler),z(o,"mousemove",this._delayedMoveHandler),z(o,"mouseup",this._cancelStart),z(o,"touchend",this._cancelStart),z(o,"touchcancel",this._cancelStart)},_onStart(o,t){at(t);let e=this.el,n=this.options,i=W(h);L=i,et=i,$=i,P=e,T=e,E=e,k=h,x=h.parentNode,X=n.group.pull,U=h,K={to:e,target:h,newIndex:i,relative:0},c=h.cloneNode(!0),g.dragged=h,g.clone=c,g.active=this,O({sortable:this,name:"onChoose",evt:this._getEventProperties(t)}),F(h,n.chosenClass,!0),_(B,o?"touchmove":"mousemove",this._nearestSortable);try{document.selection?setTimeout(()=>document.selection.empty(),0):window.getSelection().removeAllRanges()}catch{}_(document,"selectstart",at),gt&&S(document.body,"user-select","none")},_onStarted(){let o=this.options;this.animator.collect(x),this._appendGhost(),F(c,o.chosenClass,!0),F(c,o.placeholderClass,!0),h.parentNode.insertBefore(c,h),S(h,"display","none"),O({sortable:this,name:"onDrag",evt:this._getEventProperties(M.event)}),this.animator.animate(),this.autoScroller.onStarted()},_appendGhost(){if(I)return;let o=this.options;const t=o.appendToBody?document.body:this.el;I=(ct(o.customGhost,c)||c).cloneNode(!0),F(I,o.ghostClass,!0);const n=D(h),i=Object.assign({position:"fixed",top:n.top,left:n.left,width:n.width,height:n.height,margin:0,zIndex:1e5,opacity:"0.8",overflow:"hidden",boxSizing:"border-box",transform:"",transition:"",pointerEvents:"none"},o.ghostStyle);for(let a in i)S(I,a,i[a]);g.ghost=I,t.appendChild(I);const s=(M.clientX-n.left)/parseInt(I.style.width)*100,r=(M.clientY-n.top)/parseInt(I.style.height)*100;S(I,"transform-origin",`${s}% ${r}%`),S(I,"will-change","transform")},_nearestSortable(o){at(o);let t=o.touches&&o.touches[0],e=t||o;if(!h||!Jt(e))return;!A&&this._onStarted();let n=this.options.lockAxis,i=n==="x"?M.clientX:e.clientX,s=n==="y"?M.clientY:e.clientY,r=document.elementFromPoint(i,s),a=i-M.clientX,d=s-M.clientY;A={event:o,clientX:i,clientY:s},S(I,"transform",`translate3d(${a}px, ${d}px, 0)`);const f=Gt(i,s);f&&f[R]._onMove(o,r),this.autoScroller.onMove(r,A,f,this.options)},_allowPut(){let o=this.options.group,t=E[R].options.group;return this.el===E?!0:o.put?o.put.join&&o.put.indexOf(t.name)>-1||t.name&&o.name&&t.name===o.name:!1},_getDirection(){let o=this.options.draggable,t=this.options.direction;return t?ct(t,A.event,c,this):Rt(x,o)},_allowSwap(){let o=D(p),t=this._getDirection()==="vertical",e=t?"top":"left",n=t?"bottom":"right",i=p[t?"offsetHeight":"offsetWidth"],s=t?A.clientY:A.clientX,r=s>=o[e]&&s<o[n]-i/2?-1:1,a=St(x,0,this.options.draggable),d=Mt(x),f=D(a),y=D(d);if(p===x||mt(x,p))return c===a&&s<f[e]?(q=p,!0):c===d&&s>y[n]?(q=p.nextSibling,!0):!1;const v=yt(c,p);return q=v<0?p.nextSibling:p,V!==p?(j=r,!0):j!==r?(j=r,r<0?v>0:v<0):!1},_onMove(o,t){let e=this.el,n=this.options;if(!(n.disabled||!this._allowPut())){if(p=tt(t,n.draggable,e),O({sortable:this,name:"onMove",evt:this._getEventProperties(o,{target:p})}),!n.sortable&&e===E){T!==E&&(p=V=h,j=0,this._onInsert(o));return}if(e!==T&&(t===e||!Mt(e))){p=V=null,this._onInsert(o);return}if(!(!p||p.animating||mt(p,c)||!this._allowSwap())){if(p===c||q===c){V=p;return}e!==T?this._onInsert(o):p!==h&&this._onChange(o),V=p}}},_onInsert(o){let t=this.el,e=p||c,n=X==="clone"&&t!==E&&T===E,i=X==="clone"&&t===E&&T!==E,s=mt(p,document),r=p===h&&!s,a=T[R],d=E[R];P=t,L=W(c),k=e,x=s?p.parentNode:t,a.animator.collect(c.parentNode),this.animator.collect(x),n&&(K.target=U,K.newIndex=L,K.relative=U===h?0:yt(c,U),S(h,"display",""),d.options.group.revertDrag||c.parentNode.insertBefore(h,c)),i&&(L=W(h),S(h,"display","none")),S(c,"display",r?"none":""),p&&s?x.insertBefore(c,j<0?p:p.nextSibling):x.appendChild(c),et=r?$:W(c),n&&d.options.group.revertDrag&&(K.target=h,K.newIndex=$,K.relative=0,O({sortable:d,name:"onChange",evt:this._getEventProperties(o,{to:E,target:h,newIndex:$,revertDrag:!0})})),n||O({sortable:a,name:"onRemove",evt:this._getEventProperties(o,{newIndex:-1})}),i&&e!==h&&(U=e,O({sortable:this,name:"onChange",evt:this._getEventProperties(o,{from:E,backToOrigin:!0})})),i||O({sortable:this,name:"onAdd",evt:this._getEventProperties(o,{oldIndex:-1})}),a.animator.animate(),this.animator.animate(),T=t},_onChange(o){let t=this.el;this.animator.collect(x),L=W(c),x=p.parentNode,k=p,t===E&&(U=p),x.insertBefore(c,q),et=W(c),O({sortable:this,name:"onChange",evt:this._getEventProperties(o)}),O({sortable:this,name:"onDragChange",evt:this._getEventProperties(o)}),this.animator.animate(),T=t},_onDrop(o){let t=this.options;if(this._cancelStart(),z(B,"touchmove",this._nearestSortable),z(B,"mousemove",this._nearestSortable),z(B,"mouseup",this._onDrop),z(B,"touchend",this._onDrop),z(B,"touchcancel",this._onDrop),z(document,"selectstart",at),gt&&S(document.body,"user-select",""),I&&I.parentNode&&I.parentNode.removeChild(I),E)if(T=E,L=$,k===c&&(k=h),F(h,t.chosenClass,!1),O({sortable:this,name:"onUnchoose",evt:this._getEventProperties(o)}),A){this.animator.collect(x),F(c,t.chosenClass,!1),F(c,t.placeholderClass,!1);const e=this._getEventProperties(o);!t.dropOnAnimationEnd&&this._onEnd(e),this.animator.animate(()=>{t.dropOnAnimationEnd&&this._onEnd(e)})}else this._nulling();else this._nulling()},_onEnd(o){let t=this.options,e=X==="clone",n=T===P;(!e||n)&&ct(t.swapOnDrop,o)&&x.insertBefore(h,c),(!e||n)&&ct(t.removeCloneOnDrop,o)&&c&&c.parentNode&&c.parentNode.removeChild(c),S(h,"display",""),T!==P&&O({sortable:T[R],name:"onDrop",evt:Object.assign({},o,e?K:{newIndex:-1})}),O({sortable:P[R],name:"onDrop",evt:Object.assign({},o,n?{}:{oldIndex:-1})}),this._nulling()},_getEventProperties(o,t={}){let e={};return e.event=o,e.to=P,e.from=T,e.node=h,e.clone=c,e.target=k,e.oldIndex=L,e.newIndex=et,e.pullMode=X,Object.assign(e,t),e.relative=k===h?0:yt(c,k),e},_nulling(){P=T=h=p=q=E=c=I=k=x=X=L=et=$=M=A=V=B=K=U=j=g.clone=g.ghost=g.active=g.dragged=null,this.autoScroller.nulling()},destroy(){this._cancelStart(),this._nulling(),z(this.el,"touchstart",this._onDrag),z(this.el,"mousedown",this._onDrag);const o=ht.indexOf(this.el);o>-1&&ht.splice(o,1),this.el[R]=this.animator=this.autoScroller=null},option(o,t){if(t===void 0)return this.options[o];this.options[o]=t,this.animator.options[o]=t,this.autoScroller.options[o]=t,o==="group"&&Kt(this.options)}},g.utils={on:_,off:z,css:S,index:W,matches:lt,closest:tt,getRect:D,toggleClass:F,detectDirection:Rt},g.get=function(o){return o[R]},g.create=function(o,t){return new g(o,t)};function dt(o,t){let e;const n=function(...i){e||(t<=0?o.apply(this,i):e=setTimeout(()=>{e=null,o.apply(this,i)},t))};return n.cancel=function(){e&&(clearTimeout(e),e=null)},n}function Qt(o,t){const e=dt(o,t),n=function(...i){e.cancel(),e.apply(this,i)};return n.cancel=()=>{e.cancel()},n}function bt(o,t){return o===0?o===t:o==t}function Ht(o,t){return(Array.isArray(t)?t:t.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce((e,n)=>(e||{})[n],o)}function Ft(o){return o instanceof Document&&o.nodeType===9||o instanceof Window}const vt=["delay","group","handle","lockAxis","disabled","sortable","draggable","animation","autoScroll","ghostClass","ghostStyle","chosenClass","scrollSpeed","fallbackOnBody","scrollThreshold","delayOnTouchOnly","placeholderClass"];class Zt{constructor(t,e){this.el=t,this.options=e,this.rangeChanged=!1,this.installSortable()}destroy(){this.sortable.destroy(),this.rangeChanged=!1}option(t,e){this.options[t]=e,vt.includes(t)&&this.sortable.option(t,e)}installSortable(){const t=vt.reduce((e,n)=>(e[n]=this.options[n],e),{});this.sortable=new g(this.el,{...t,emptyInsertThreshold:0,swapOnDrop:e=>e.from===e.to,removeCloneOnDrop:e=>e.from===e.to,onDrag:e=>this.onDrag(e),onDrop:e=>this.onDrop(e),onDragChange:e=>this.onDragChange(e),onChoose:e=>this.onChoose(e),onUnchoose:e=>this.onUnchoose(e)})}onChoose(t){this.dispatchEvent("onChoose",t)}onUnchoose(t){this.dispatchEvent("onUnchoose",t)}onDrag(t){const e=t.node.getAttribute("data-key"),n=this.getIndex(e),i=this.options.list[n],s=this.options.uniqueKeys[n];this.sortable.option("store",{item:i,key:s,index:n,oldIndex:n}),this.dispatchEvent("onDrag",{item:i,key:s,index:n,event:t})}onDragChange(t){const e=g.get(t.from)?.option("store"),n=e?e.oldIndex:-1,i=t.target.getAttribute("data-key");let s=this.getIndex(i);if(i!=null&&(n<s&&t.relative===-1||n>s&&t.relative===1)&&(s+=t.relative),n===s)return;const r={key:i,oldIndex:n,newIndex:s,event:t,item:this.options.list[s]};this.sortable.option("store").oldIndex=s,this.dispatchEvent("onDragChange",r)}onDrop(t){const{item:e,key:n,index:i}=g.get(t.from)?.option("store"),s=this.options.list,r={key:n,item:e,list:s,event:t,changed:!1,oldList:[...s],oldIndex:i,newIndex:i};t.from===t.to&&t.node===t.target||this.handleDropEvent(t,r,i),this.dispatchEvent("onDrop",r),t.from===this.el&&this.rangeChanged&&g.dragged?.remove(),t.from!==t.to&&g.clone?.remove(),this.rangeChanged=!1}handleDropEvent(t,e,n){const i=t.target.getAttribute("data-key");let s=-1,r=n;t.from===t.to?(r=this.getIndex(e.key),s=this.getIndex(i),(r<s&&t.relative===-1||r>s&&t.relative===1)&&(s+=t.relative),s!==r&&(e.list.splice(r,1),e.list.splice(s,0,e.item))):(t.from===this.el&&(r=this.getIndex(e.key),e.list.splice(r,1)),t.to===this.el&&(r=-1,s=this.getIndex(i),t.relative===0?s=e.list.length:t.relative===1&&(s+=t.relative),e.list.splice(s,0,e.item))),e.changed=t.from!==t.to||s!==r,e.oldIndex=r,e.newIndex=s}getIndex(t){if(t==null)return-1;const{uniqueKeys:e}=this.options;for(let n=0,i=e.length;n<i;n++)if(bt(e[n],t))return n;return-1}dispatchEvent(t,e){const n=this.options[t];n&&n(e)}}const te=["size","keeps","scroller","direction","debounceTime","throttleTime"];class ee{constructor(t){this.options=t;const e={size:0,keeps:0,buffer:0,wrapper:null,scroller:null,direction:"vertical",uniqueKeys:[],debounceTime:null,throttleTime:null};for(const n in e)!(n in this.options)&&(this.options[n]=e[n]);this.sizes=new Map,this.sizeType="INIT",this.fixedSize=0,this.averageSize=0,this.range={start:0,end:0,front:0,behind:0},this.offset=0,this.direction="STATIONARY",this.updateScrollElement(),this.updateOnScrollFunction(),this.addScrollEventListener(),this.checkIfUpdate(0,t.keeps-1)}isFixed(){return this.sizeType==="FIXED"}isFront(){return this.direction==="FRONT"}isBehind(){return this.direction==="BEHIND"}isHorizontal(){return this.options.direction==="horizontal"}getSize(t){return this.sizes.get(t)||this.getItemSize()}getOffset(){const t=this.isHorizontal()?"scrollLeft":"scrollTop";return this.scrollEl[t]}getScrollSize(){const t=this.isHorizontal()?"scrollWidth":"scrollHeight";return this.scrollEl[t]}getClientSize(){const t=this.isHorizontal()?"offsetWidth":"offsetHeight";return this.scrollEl[t]}scrollToOffset(t){const e=this.isHorizontal()?"scrollLeft":"scrollTop";this.scrollEl[e]=t}scrollToIndex(t){if(t>=this.options.uniqueKeys.length-1)this.scrollToBottom();else{const e=this.getOffsetByRange(0,t),n=this.getScrollStartOffset();this.scrollToOffset(e+n)}}scrollToBottom(){const t=this.getScrollSize();this.scrollToOffset(t),setTimeout(()=>{const e=this.getClientSize(),n=this.getScrollSize();this.getOffset()+e+1<n&&this.scrollToBottom()},5)}option(t,e){const n=this.options[t];this.options[t]=e,t==="uniqueKeys"&&this.sizes.forEach((i,s)=>{e.includes(s)||this.sizes.delete(s)}),t==="scroller"&&(n&&g.utils.off(n,"scroll",this.onScroll),this.updateScrollElement(),this.addScrollEventListener())}updateRange(t){if(t){this.handleUpdate(t.start);return}let e=this.range.start;e=Math.max(e,0),this.handleUpdate(e)}onItemResized(t,e){!e||this.sizes.get(t)===e||(this.sizes.set(t,e),this.sizeType==="INIT"?(this.sizeType="FIXED",this.fixedSize=e):this.isFixed()&&this.fixedSize!==e&&(this.sizeType="DYNAMIC",this.fixedSize=0),!this.averageSize&&this.sizeType==="DYNAMIC"&&this.sizes.size===this.options.keeps&&this.updateAverageSize())}updateAverageSize(){const t=[...this.sizes.values()].reduce((e,n)=>e+n,0);this.averageSize=Math.round(t/this.sizes.size)}addScrollEventListener(){this.options.scroller&&g.utils.on(this.options.scroller,"scroll",this.onScroll)}removeScrollEventListener(){this.options.scroller&&g.utils.off(this.options.scroller,"scroll",this.onScroll)}enableScroll(t){const{scroller:e}=this.options,n=t?g.utils.off:g.utils.on,i="onwheel"in document.createElement("div")?"wheel":"mousewheel";n(e,"DOMMouseScroll",this.preventDefault),n(e,i,this.preventDefault),n(e,"touchmove",this.preventDefault),n(e,"keydown",this.preventDefaultForKeyDown)}preventDefault(t){t.preventDefault()}preventDefaultForKeyDown(t){if({37:1,38:1,39:1,40:1}[t.keyCode])return this.preventDefault(t),!1}updateScrollElement(){const t=this.options.scroller;if(Ft(t)){const e=document.scrollingElement||document.documentElement||document.body;this.scrollEl=e}else this.scrollEl=t}updateOnScrollFunction(){const{debounceTime:t,throttleTime:e}=this.options;t?this.onScroll=Qt(()=>this.handleScroll(),t):e?this.onScroll=dt(()=>this.handleScroll(),e):this.onScroll=()=>this.handleScroll()}handleScroll(){const t=this.getOffset(),e=this.getClientSize(),n=this.getScrollSize();t===this.offset?this.direction="STATIONARY":this.direction=t<this.offset?"FRONT":"BEHIND",this.offset=t;const i=this.isFront()&&t<=0,s=this.isBehind()&&e+t+1>=n;this.options.onScroll({top:i,bottom:s,offset:t,direction:this.direction}),this.isFront()?this.handleScrollFront():this.isBehind()&&this.handleScrollBehind()}handleScrollFront(){const t=this.getScrollItems();if(t>=this.range.start)return;const e=Math.max(t-this.options.buffer,0);this.checkIfUpdate(e,this.getEndByStart(e))}handleScrollBehind(){const t=this.getScrollItems();t<this.range.start+this.options.buffer||this.checkIfUpdate(t,this.getEndByStart(t))}getScrollItems(){const t=this.offset-this.getScrollStartOffset();if(t<=0)return 0;if(this.isFixed())return Math.floor(t/this.fixedSize);let e=0,n=this.options.uniqueKeys.length,i=0,s=0;for(;e<=n;){if(i=e+Math.floor((n-e)/2),s=this.getOffsetByRange(0,i),s===t)return i;s<t?e=i+1:s>t&&(n=i-1)}return e>0?--e:0}checkIfUpdate(t,e){const n=this.options.keeps;this.options.uniqueKeys.length<=n?t=0:e-t<n-1&&(t=e-n+1),this.range.start!==t&&this.handleUpdate(t)}handleUpdate(t){this.range.start=t,this.range.end=this.getEndByStart(t),this.range.front=this.getFrontOffset(),this.range.behind=this.getBehindOffset(),this.options.onUpdate({...this.range})}getFrontOffset(){return this.isFixed()?this.fixedSize*this.range.start:this.getOffsetByRange(0,this.range.start)}getBehindOffset(){const t=this.range.end,e=this.getLastIndex();return this.isFixed()?(e-t)*this.fixedSize:(e-t)*this.getItemSize()}getOffsetByRange(t,e){if(t>=e)return 0;let n=0;for(let i=t;i<e;i++){const s=this.sizes.get(this.options.uniqueKeys[i]);n=n+(typeof s=="number"?s:this.getItemSize())}return n}getEndByStart(t){return Math.min(t+this.options.keeps-1,this.getLastIndex())}getLastIndex(){const{uniqueKeys:t,keeps:e}=this.options;return t.length>0?t.length-1:e-1}getItemSize(){return this.isFixed()?this.fixedSize:this.options.size||this.averageSize}getScrollStartOffset(){const{wrapper:t,scroller:e}=this.options;if(e===t)return 0;let n=0;if(e&&t){const i=this.isHorizontal()?"left":"top",s=Ft(e)?g.utils.getRect(t):g.utils.getRect(t,!0,e);n=this.offset+s[i]}return n}}const oe={modelValue:{},dataKey:{type:String,default:"",required:!0},tableMode:{type:Boolean,default:!1},draggable:{type:String,default:'[role="item"]'},sortable:{type:Boolean,default:!0},handle:{type:[Function,String],default:void 0},group:{type:[Object,String],default:void 0},scroller:{type:[Document,HTMLElement],default:void 0},lockAxis:{type:String,default:""},direction:{type:String,default:"vertical"},keeps:{type:Number,default:30},size:{type:Number,default:void 0},debounceTime:{type:Number,default:0},throttleTime:{type:Number,default:0},animation:{type:Number,default:150},autoScroll:{type:Boolean,default:!0},scrollSpeed:{type:Object,default:()=>({x:10,y:10})},scrollThreshold:{type:Number,default:55},keepOffset:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},fallbackOnBody:{type:Boolean,default:!1},delay:{type:Number,default:0},delayOnTouchOnly:{type:Boolean,default:!1},rootTag:{type:String,default:"div"},wrapTag:{type:String,default:"div"},wrapClass:{type:String,default:""},wrapStyle:{type:Object,default:()=>({})},ghostClass:{type:String,default:""},ghostStyle:{type:Object,default:()=>({})},chosenClass:{type:String,default:""},placeholderClass:{type:String,default:""}},ne={dataKey:{type:[String,Number],default:void 0},sizeKey:{type:String,default:"offsetHeight"}},ie=({mounted:o,updated:t,unmounted:e})=>m.defineComponent({props:["vnode"],mounted(){o(this.$el)},onUpdated(){t(this.$el)},onUnmounted(){e(this.$el)},render(n){return n.vnode}}),se=m.defineComponent({props:ne,emits:["resize"],setup(o,{emit:t,slots:e}){let n=null;const i=f=>{const y=f?f[o.sizeKey]:0;t("resize",y,o.dataKey)},d=ie({mounted:f=>{typeof ResizeObserver<"u"&&(n=new ResizeObserver(()=>{i(f)}),f&&n.observe(f))},updated:f=>{i(f)},unmounted:()=>{n&&(n.disconnect(),n=null)}});return()=>{const{dataKey:f}=o,[y]=e.default?.()||[];return m.h(d,{key:f,role:"item",vnode:y,"data-key":f},{default:()=>e.default?.()})}}}),re=o=>m.isRef(o)?o.value:o,Lt=m.defineComponent({props:oe,emits:["update:modelValue","top","bottom","drag","dragChange","drop","rangeChange"],setup(o,{emit:t,slots:e,expose:n}){const i=m.ref([]),s=m.ref({start:0,end:o.keeps-1,front:0,behind:0}),r=m.computed(()=>o.direction!=="vertical"),a=m.ref(),d=m.ref();function f(l){return w.getSize(l)}function y(){return w.getOffset()}function v(){return w.getClientSize()}function C(){return w.getScrollSize()}function ot(l){const u=G.indexOf(l);u>-1&&w.scrollToIndex(u)}function Y(l){w.scrollToOffset(l)}function ut(l){w.scrollToIndex(l)}function wt(){Y(0)}function xt(){w.scrollToBottom()}n({getSize:f,getOffset:y,getClientSize:v,getScrollSize:C,scrollToTop:wt,scrollToBottom:xt,scrollToKey:ot,scrollToIndex:ut,scrollToOffset:Y}),m.watch(()=>[o.modelValue],()=>{Pt()},{deep:!0}),m.onBeforeMount(()=>{Pt()}),m.onActivated(()=>{w&&Y(w.offset),w.addScrollEventListener()}),m.onDeactivated(()=>{w.removeScrollEventListener()}),m.onMounted(()=>{pe(),we()}),m.onUnmounted(()=>{N?.destroy(),w?.removeScrollEventListener()});let Wt=[],G=[],nt=0;const Pt=()=>{const l=re(o.modelValue);if(l){if(i.value=l,le(),ae(Wt,l),N?.option("list",l),nt&&o.keepOffset){const u=l.length-nt;u>0&&ut(u),nt=0}Wt=[...i.value]}},le=()=>{G=i.value.map(l=>Ht(l,o.dataKey)),w?.option("uniqueKeys",G),N?.option("uniqueKeys",G)},ae=(l,u)=>{if(!l.length&&!u.length||l.length===u.length)return;let b={...s.value};l.length>o.keeps&&u.length>l.length&&b.end===l.length-1&&ce()&&b.start++,w?.updateRange(b)},ce=()=>{const l=y(),u=v(),b=C();return l+u+1>=b};let w;const ft=m.ref(!1),pt=m.ref(""),Ut=m.computed(()=>te.reduce((l,u)=>(l[u]=o[u],l),{}));m.watch(Ut,(l,u)=>{if(w)for(let b in l)l[b]!==u[b]&&w.option(b,l[b])});const he=dt(()=>{nt=i.value.length,t("top")},50),de=dt(()=>{t("bottom")},50),ue=l=>{nt=0,i.value.length&&l.top?he():l.bottom&&de()},fe=l=>{const u=l.start!==s.value.start;ft.value&&u&&N&&(N.rangeChanged=!0),s.value=l,u&&t("rangeChange",l)},pe=()=>{w=new ee({...Ut.value,buffer:Math.round(o.keeps/3),wrapper:d.value,scroller:o.scroller||a.value,uniqueKeys:G,onScroll:ue,onUpdate:fe})},ge=(l,u)=>{if(bt(u,pt.value))return;const b=w.sizes.size;w.onItemResized(u,l),b===o.keeps-1&&i.value.length>o.keeps&&w.updateRange(s.value)};let N;const Yt=m.computed(()=>vt.reduce((l,u)=>(l[u]=o[u],l),{}));m.watch(Yt,(l,u)=>{if(N)for(let b in l)l[b]!==u[b]&&N.option(b,l[b])});const me=l=>{pt.value=l.node.getAttribute("data-key")},Se=()=>{pt.value=""},ye=l=>{ft.value=!0,o.sortable||(w.enableScroll(!1),N.option("autoScroll",!1)),t("drag",l)},be=l=>{t("dragChange",l)},ve=l=>{ft.value=!1,w.enableScroll(!0),N.option("autoScroll",o.autoScroll),l.changed&&t("update:modelValue",l.list),t("drop",l)},we=()=>{N=new Zt(a.value,{...Yt.value,list:i.value,uniqueKeys:G,onDrag:ye,onDrop:ve,onChoose:me,onUnchoose:Se,onDragChange:be})},qt=l=>{const u=r.value?"width":"height";if(o.tableMode){const b={padding:0,border:0,[u]:`${l}px`};return m.h("tr",{},[m.h("td",{style:b})])}return null},xe=()=>{const l=[],{start:u,end:b,front:Et,behind:It}=s.value,Tt=r.value?"offsetWidth":"offsetHeight";l.push(qt(Et));for(let J=u;J<=b;J++){const it=i.value[J];if(it){const Q=Ht(it,o.dataKey),Ct=bt(Q,pt.value);l.push(e.item?m.h(se,{key:Q,style:ft.value&&Ct&&{display:"none"},dataKey:Q,sizeKey:Tt,onResize:ge},{default:()=>e.item?.({record:it,index:J,dataKey:Q})}):null)}}return l.push(qt(It)),l};return()=>{const{front:l,behind:u}=s.value,{tableMode:b,rootTag:Et,wrapTag:It,scroller:Tt,wrapClass:J,wrapStyle:it}=o,Q=r.value?"auto hidden":"hidden auto",Ct=r.value?`0 ${u}px 0 ${l}px`:`${l}px 0 ${u}px`,Ee=b?"table":Et,Ie=b?"tbody":It;return m.h(Ee,{ref:a,style:!Tt&&!b&&{overflow:Q}},{default:()=>[e.header?.(),m.h(Ie,{ref:d,class:J,style:{...it,padding:!b&&Ct}},{default:()=>xe()}),e.footer?.()]})}}});H.VirtualSortable=Lt,H.default=Lt,Object.defineProperties(H,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
